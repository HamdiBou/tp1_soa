version: '3.8'

services:
  dev-environment:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: soa_tp_dev
    volumes:
      # Mount your workspace
      - ./workspace:/workspace
      # Mount Maven cache to speed up builds
      - maven-cache:/root/.m2
    ports:
      # Spring Boot application
      - "8090:8090"
      # H2 Console
      - "8088:8088"
      # Angular Development Server
      - "4200:4200"
    environment:
      - JAVA_OPTS=-Xmx512m
    stdin_open: true
    tty: true
    networks:
      - soa-network
    command: >
      bash -c "
        echo 'ðŸš€ Starting Spring Boot backend...' &&
        cd /workspace/menu_java &&
        mvn spring-boot:run > /workspace/spring-boot.log 2>&1 &
        echo 'â³ Waiting for Spring Boot to start...' &&
        sleep 10 &&
        echo 'ðŸŽ¨ Starting Angular frontend...' &&
        cd /workspace/speedliv-client &&
        ng serve --host 0.0.0.0 --port 4200 > /workspace/angular.log 2>&1 &
        echo 'âœ… Both servers are starting!' &&
        echo '   Backend: http://localhost:8088' &&
        echo '   Frontend: http://localhost:4200' &&
        echo '   Check logs: docker exec soa_tp_dev tail -f /workspace/spring-boot.log' &&
        echo '              docker exec soa_tp_dev tail -f /workspace/angular.log' &&
        tail -f /dev/null
      "


  # Optional: Separate H2 database service (if you want external H2)
  h2-database:
    image: oscarfonts/h2:latest
    container_name: soa_h2_db
    ports:
      - "1521:1521"
      - "8082:8082"
    environment:
      - H2_OPTIONS=-ifNotExists
    volumes:
      - h2-data:/opt/h2-data
    networks:
      - soa-network

volumes:
  maven-cache:
  h2-data:

networks:
  soa-network:
    driver: bridge